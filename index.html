<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Crossing the Information Cocoon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Top progress microbar (A‚ÜíB‚ÜíC‚ÜíD) -->
    <div id="progressBar" aria-hidden="true">
      <span data-step="A" title="A: Explore Bubbles"></span>
      <span data-step="B" title="B: Feed"></span>
      <span data-step="C" title="C: Build My Bubble"></span>
      <span data-step="D" title="D: My Cocoon Feed"></span>
    </div>

    <!-- Header -->
    <header class="site-header">
      <div class="brand">ü´ß Bubble Switch</div>
      <nav class="menu">
        <a href="#" title="Home">Home</a>
        <a href="#" title="Method">Method</a>
        <a href="#" title="About">About</a>
      </nav>
      <div class="actions">
        <input
          id="searchInput"
          type="search"
          placeholder="Search a group, e.g., K-pop, gamer, vegan..."
        />
        <button
          id="buildBtn"
          class="btn btn-primary"
          aria-pressed="false"
          title="Build your personal cocoon"
        >
          Build My Bubble
        </button>
      </div>
    </header>

    <!-- Bubble pool -->
    <main id="poolWrap" aria-label="Bubble pool">
      <canvas id="poolCanvas"></canvas>

      <!-- Builder overlay (no modal; dim background, focus tags + cocoon) -->
      <div id="builderUI" aria-hidden="true">
        <button
          id="builderExit"
          class="btn btn-ghost exit"
          aria-label="Exit build mode"
        >
          ‚úï
        </button>

        <section class="builder-side">
          <h2 class="builder-title">Build your cocoon</h2>
          <p class="builder-sub">
            Drag at least <strong>3</strong> tags into the big bubble.
          </p>
          <div class="legend" id="chipLegend" aria-label="Tag legend"></div>
          <div class="picked">Selected: <span id="pickedCount">0</span></div>
        </section>

        <!-- Big bubble target -->
        <div id="bigBubble" aria-label="Target cocoon">
          <div class="bb-core">
            <div class="bb-title">My Cocoon</div>
            <div class="bb-tags" id="bbTags"></div>
            <div class="bb-cta">
              <button id="enterBtn" class="btn btn-success" disabled>
                Enter My Cocoon ‚Üí
              </button>
              <button id="resetBuildBtn" class="btn btn-ghost">Reset</button>
            </div>
          </div>
        </div>

        <!-- Tag grid (draggable pills) -->
        <div id="tagLayer" role="list"></div>
      </div>
    </main>

    <!-- Zoom circle for transitions -->
    <div id="zoomCircle" aria-hidden="true"></div>

    <!-- Feed view -->
    <section id="feedView" aria-hidden="true">
      <div class="feed-header">
        <div class="left">
          <!-- Return main button -->
          <button id="backBtn" class="btn btn-primary">‚Üê Return</button>
        </div>

        <div class="feed-identity">
          <span id="feedTag" class="pill" data-cat=""></span>
          <span id="feedCategory" class="pill pill-outline" data-cat=""></span>
        </div>

        <div class="right">
          <button
            id="compareBtn"
            class="btn btn-secondary"
            aria-pressed="false"
            title="Compare Mode (Left/Center/Right)"
          >
            Compare Mode
          </button>

          <button
            id="toggleViewBtn"
            class="btn btn-secondary"
            aria-pressed="false"
            title="Show contrasting/hidden articles"
          >
            Show Hidden View
          </button>
          <span
            id="diversityBadge"
            class="badge"
            title="Diversity Score (coverage ¬∑ stance ¬∑ sources)"
            >Diversity Score: --%</span
          >
          <button
            id="teleportBtn"
            class="btn btn-danger"
            title="Teleport to adjacent perspective"
          >
            Teleport ‚ú¶
          </button>
          <button
            id="modeBackBtn"
            class="btn btn-ghost small"
            style="display: none"
            title="Back to original feed"
          >
            Back
          </button>
        </div>
      </div>

      <!-- Mode noticeÔºöFixed bottom -->
      <div id="modeNotice" role="status" aria-live="polite"></div>

      <div class="feed-body">
        <div id="feedList" class="feed-list"></div>

        <!-- Right panel (starts hidden until user clicks Show Hidden View; also hidden in Teleport/MyBubble) -->
        <aside id="hiddenPanel" class="hidden-panel" aria-live="polite" hidden>
          <h3>Contrasting / Hidden View</h3>
          <div id="hiddenList" class="hidden-list"></div>
        </aside>
      </div>
    </section>

    <!-- Particle canvas -->
    <canvas id="burstCanvas" aria-hidden="true"></canvas>

    <!-- Lightweight in-site panel -->
    <div id="panelMethod" class="sheet" hidden>
      <div class="sheet-body">
        <h3>Method</h3>
        <p>
          Drag identity tags to build a cocoon; toggle Hidden View to surface
          contrasting posts; Compare Mode aggregates topics into CON / NEUTRAL /
          PRO.
        </p>
        <button class="btn btn-ghost" id="closeMethod">Close</button>
      </div>
    </div>
    <div id="panelAbout" class="sheet" hidden>
      <div class="sheet-body">
        <h3>About</h3>
        <p>
          Bubble Switch explores filtering bubbles and diversity. Build mode
          blurs background only; tags & cocoon stay crisp for focus.
        </p>
        <button class="btn btn-ghost" id="closeAbout">Close</button>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
